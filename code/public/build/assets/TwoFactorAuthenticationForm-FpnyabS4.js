import{r as v,e as L,s as M,E as N,f as D,c as y,o,w as a,h as s,a as l,i as u,t,d as r,b as i,H as P,u as F,F as Q,j as Y,n as b,q as R}from"./app-CapNgXf-.js";import{_ as O}from"./ActionSection-Cf9mlxMW.js";import{_ as T}from"./Button-CeJKJvkU.js";import{_}from"./ConfirmsPassword-Pp1Q4xjp.js";import{_ as j}from"./DangerButton-C3VCCtYy.js";import{_ as z}from"./Input-DBW5TJZF.js";import{_ as U}from"./InputError-BapgdLlk.js";import{_ as W}from"./Label-WzmNYhjC.js";import{_ as C}from"./SecondaryButton-LDZ02WBB.js";import{_ as G}from"./ConfirmationModal-C4kmuD-S.js";import"./SectionTitle-yCtI3_Xi.js";import"./PrettyButton-C7IwNjfl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./createLucideIcon-jKXsEGte.js";import"./DialogModal-DpvCIBlW.js";import"./Modal-Cq3DqFWU.js";import"./WebauthnTest-DWVvjNye.js";import"./WaitForKey-BYvq9w9Y.js";import"./startAuthentication-BTaWR7aw.js";const I={key:0,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},J={key:1,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},X={key:2,class:"text-lg font-medium text-gray-900 dark:text-gray-100"},Z={class:"mt-3 max-w-xl text-sm text-gray-600 dark:text-gray-400"},ee={key:3},te={key:0},oe={class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},ae={key:0,class:"font-semibold"},se={key:1},ne=["innerHTML"],re={key:0,class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},ie={class:"font-semibold"},le=["innerHTML"],ue={key:1,class:"mt-4"},ce={key:1},de={class:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400"},me={class:"font-semibold"},fe={class:"mt-4 grid max-w-xl gap-1 rounded-lg bg-gray-100 px-4 py-4 font-mono text-sm dark:bg-gray-950"},ve={class:"mt-5"},pe={key:0},he={key:1},He={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(V){const B=V,m=v(!1),n=v(!1),c=v(!1),k=v(null),$=v(null),g=v([]),w=v(!1),p=L({code:""}),h=M(()=>!m.value&&N().props.auth.user?.two_factor_enabled);D(h,()=>{h.value||(p.reset(),p.clearErrors())});const K=()=>{m.value=!0,R.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>Promise.all([q(),E(),x()]),onFinish:()=>{m.value=!1,n.value=B.requiresConfirmation}})},q=()=>axios.get(route("two-factor.qr-code")).then(e=>{k.value=e.data.svg}),E=()=>axios.get(route("two-factor.secret-key")).then(e=>{$.value=e.data.secretKey}),x=()=>axios.get(route("two-factor.recovery-codes")).then(e=>{g.value=e.data}),S=()=>{p.post(route("two-factor.confirm"),{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{n.value=!1,k.value=null,$.value=null}})},H=()=>{axios.post(route("two-factor.recovery-codes")).then(()=>x())},A=()=>{c.value=!0,R.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{c.value=!1,n.value=!1},onFinish:()=>{w.value=!1}})};return(e,d)=>(o(),y(O,null,{title:a(()=>[r(t(e.$t("Two Factor Authentication")),1)]),description:a(()=>[r(t(e.$t("Add additional security to your account using two factor authentication.")),1)]),content:a(()=>[h.value&&!n.value?(o(),s("h3",I,t(e.$t("You have enabled two factor authentication.")),1)):h.value&&n.value?(o(),s("h3",J,t(e.$t("Finish enabling two factor authentication.")),1)):(o(),s("h3",X,t(e.$t("You have not enabled two factor authentication.")),1)),l("div",Z,[l("p",null,t(e.$t("When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone’s Authenticator application.")),1)]),h.value?(o(),s("div",ee,[k.value?(o(),s("div",te,[l("div",oe,[n.value?(o(),s("p",ae,t(e.$t("To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code.")),1)):(o(),s("p",se,t(e.$t("Two factor authentication is now enabled. Scan the following QR code using your phone’s authenticator application or enter the setup key.")),1))]),l("div",{class:"mt-4",innerHTML:k.value},null,8,ne),$.value?(o(),s("div",re,[l("p",ie,[r(t(e.$t("Setup Key:"))+" ",1),l("span",{innerHTML:$.value},null,8,le)])])):u("",!0),n.value?(o(),s("div",ue,[i(W,{for:"code",value:e.$t("Code")},null,8,["value"]),i(z,{id:"code",modelValue:F(p).code,"onUpdate:modelValue":d[0]||(d[0]=f=>F(p).code=f),type:"text",name:"code",class:"mt-1 block w-1/2",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:P(S,["enter"])},null,8,["modelValue"]),i(U,{message:F(p).errors.code,class:"mt-2"},null,8,["message"])])):u("",!0)])):u("",!0),g.value.length>0&&!n.value?(o(),s("div",ce,[l("div",de,[l("p",me,t(e.$t("Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost.")),1)]),l("div",fe,[(o(!0),s(Q,null,Y(g.value,f=>(o(),s("div",{key:f},t(f),1))),128))])])):u("",!0)])):u("",!0),l("div",ve,[h.value?(o(),s("div",he,[i(_,{onConfirmed:S},{default:a(()=>[n.value?(o(),y(T,{key:0,type:"button",class:b(["me-3",{"opacity-25":m.value}]),disabled:m.value},{default:a(()=>[r(t(e.$t("Confirm")),1)]),_:1},8,["class","disabled"])):u("",!0)]),_:1}),i(_,{onConfirmed:H},{default:a(()=>[g.value.length>0&&!n.value?(o(),y(C,{key:0,class:"me-3"},{default:a(()=>[r(t(e.$t("Regenerate Recovery Codes")),1)]),_:1})):u("",!0)]),_:1}),i(_,{onConfirmed:x},{default:a(()=>[g.value.length===0&&!n.value?(o(),y(C,{key:0,class:"me-3"},{default:a(()=>[r(t(e.$t("Show Recovery Codes")),1)]),_:1})):u("",!0)]),_:1}),i(_,{onConfirmed:A},{default:a(()=>[n.value?(o(),y(C,{key:0,class:b({"opacity-25":c.value}),disabled:c.value},{default:a(()=>[r(t(e.$t("Cancel")),1)]),_:1},8,["class","disabled"])):u("",!0)]),_:1}),i(_,{onConfirmed:d[1]||(d[1]=f=>w.value=!0)},{default:a(()=>[n.value?u("",!0):(o(),y(j,{key:0},{default:a(()=>[r(t(e.$t("Disable")),1)]),_:1}))]),_:1}),i(G,{show:w.value,onClose:d[3]||(d[3]=f=>w.value=!1)},{title:a(()=>[r(t(e.$t("Are you sure you want to disable two factor authentication?")),1)]),content:a(()=>[r(t(e.$t("Once two factor authentication is disabled, you will no longer be prompted for a secure, random token during authentication.")),1)]),footer:a(()=>[i(C,{onClick:d[2]||(d[2]=f=>w.value=!1),class:b({"opacity-25":c.value}),disabled:c.value},{default:a(()=>[r(t(e.$t("Cancel")),1)]),_:1},8,["class","disabled"]),i(T,{class:b(["ms-2",{"opacity-25":c.value}]),disabled:c.value,onClick:A},{default:a(()=>[r(t(e.$t("Confirm")),1)]),_:1},8,["class","disabled"])]),_:1},8,["show"])])):(o(),s("div",pe,[i(_,{onConfirmed:K},{default:a(()=>[i(T,{type:"button",class:b({"opacity-25":m.value}),disabled:m.value},{default:a(()=>[r(t(e.$t("Enable")),1)]),_:1},8,["class","disabled"])]),_:1})]))])]),_:1}))}};export{He as default};

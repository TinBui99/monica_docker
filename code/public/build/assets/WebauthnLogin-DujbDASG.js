import{r as l,e as w,f as S,v as A,S as h,p as u,h as i,o as c,t as K,u as p,b as d,D as k}from"./app-CapNgXf-.js";import{_ as W}from"./InputError-BapgdLlk.js";import{_ as B}from"./WaitForKey-BYvq9w9Y.js";import{b as v,a as M,s as x}from"./startAuthentication-BTaWR7aw.js";function E(){return v()?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():new Promise(s=>s(!1))}const N={key:0},O={key:1},P={__name:"WebauthnLogin",props:{publicKey:Object,remember:Boolean,autofill:Boolean},setup(s){const o=s,m=l(!0),r=l(""),f=l(!1),a=w({});S(()=>o.publicKey,t=>{r.value="",n(t)}),A(()=>{v()||(m.value=!1,r.value=h()),o.publicKey&&E().then(t=>{t?n(o.publicKey):r.value=u("This browser does not support autofill.")})});const _=(t,e)=>{switch(t){case"InvalidStateError":return u("Unexpected error on login.");case"NotAllowedError":return u("The operation either timed out or was not allowed.");default:return e}},g=()=>{r.value="",k(()=>{n(o.publicKey)})},b=()=>{f.value=!1},n=t=>{f.value=!0,M().then(e=>x({optionsJSON:t,useBrowserAutofill:o.autofill&&e})).then(e=>y(e)).catch(e=>{r.value=_(e.name,e.message)})},y=t=>{a.transform(()=>({...t,remember:o.remember?"on":""})).post(route("webauthn.auth"),{preserveScroll:!0,preserveState:!0,onSuccess:()=>b(),onError:e=>{r.value=e.message??e.data.errors[0],b()}})};return(t,e)=>(c(),i("div",null,[m.value?(c(),i("div",O,[d(B,{"error-message":r.value,form:p(a),onRetry:e[0]||(e[0]=T=>g())},null,8,["error-message","form"]),d(W,{message:p(a).errors.data,class:"mt-2"},null,8,["message"])])):(c(),i("div",N,K(p(h)()),1))]))}},C=Object.freeze(Object.defineProperty({__proto__:null,default:P},Symbol.toStringTag,{value:"Module"}));export{C as W,P as _,E as p};
